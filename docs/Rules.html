<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="doc.css" media="all">
		<title>
			claire : Rules
		</title>
		<style>
body {
        font-size: 14px;
        font-family: arial, Helvetica;
}

h1 { font-size: 25px; }
h2 { font-size: 20px; }

a[href] {
	border-bottom: 1px dotted grey;
	text-decoration: none
}

.doc_paragraph
{
        font-size: 14px;
        font-family: arial, helvetica;
}

.item_header { font-size: 10px; page-break-before: avoid; page-break-inside: avoid; page-break-after: avoid }

.item_index {
		white-space: pre;
        font-size: 11px;
        font-family: monaco, courier, mono-space;
}

.table_code {
		margin: 10px auto;
}

.doc_code {
    white-space: pre;
		padding-top: .1em;
		padding-bottom: .5em;
		background-color: #EEE;
		border: #AAA solid 1px;
        font-size: 11px;
        font-family: monaco, courier, mono-space;
}

.opt_usage {
		margin-left: 1em;
		margin-right: 1em;
		padding: .2em;
		background-color: #EEE;
		border: #AAA solid 1px;
        font-family: monaco, courier, mono-space;
	
}

.class_proto {
	vertical-align: top;
	text-align: right;
}

.class_proto_super {
	vertical-align: top;
	text-align: right;
}

.class_proto_slot {
	vertical-align: top;
	text-align: left;
}

</style>
	</head>
	<body><table width='100%' class='item_header'>
		<tr>
			<td width='33%' align='left' valign='bottom'><i><a href='Tables.html#4611703541554717490'>Tables</a></i></td>
			<td width='33%' align='center' valign='top'><i><a href='claire.index.html#__category_index__'>categories</a><br/><a href='claire.index.html#4611703541554778466'>Tables, Rules and Hypothetical Reasoning</a><br/><b>Rules</b>
				</i></td>
			<td width='33%' align='right' valign='bottom'><i><a href='Hypothetical Reasoning.html#4611703541554934354'>Hypothetical Reasoning</a></i></td>
		</tr>
	</table>
	<h2><span class=pretitle>&nbsp;</span>&nbsp;<a name='4611703541554789746'>Rules</a>
			</h2>
	<ul></ul><ul></ul><p align='justify' class='doc_paragraph'> A rule in CLAIRE is made by associating an event condition to an expression.
 The rule is attached to a <a href='Lists_comma Sets and Tuples.html#4611703541553841378'><font color='#'>set</font></a> of free variables of given <a href='Types.html#4611703541554225330'><font color='#'>types</font></a>: each <a href='Dates and Times.html#4611703541553608578'><font color='#'>time</font></a> that an event
 that matches the condition becomes occurs for a given binding of the variables (i.e.,
 association of one value to each variable), the expression will be evaluated with this
 binding. The interest of rules is to attach an expression <a href='Objects and Entities.html#4611703541555698978'><font color='#'>not</font></a> to a functional <a href='Calls and Slot Access.html#4611703541555624690'><font color='#'>call</font></a> (as
 with <a href='Methods.html#4611703541554221778'><font color='#'>methods</font></a>) but to an event, with a binding that is more flexible (many rules can be
 combined for one event) and more incremental.
 </p>
									<table align='center' width='80%'>
									<tr><td><p align='justify' class='doc_paragraph'>
										<b>Definition : </b><i> A rule is an <a href='Objects and Entities.html#4611703541553611170'><font color='#'>object</font></a> that binds a condition to an action, called its conclusion. Each <a href='Dates and Times.html#4611703541553608578'><font color='#'>time</font></a>
 the condition becomes true for a <a href='Lists_comma Sets and Tuples.html#4611703541553841378'><font color='#'>set</font></a> of <a href='Objects and Entities.html#4611703541553611170'><font color='#'>objects</font></a> because of a <a href='Classes.html#4611703541555700274'><font color='#'>new</font></a> event, the conclusion is
 executed. The condition is expressed as a logic formula on one or more free variables that
 represent <a href='Objects and Entities.html#4611703541553611170'><font color='#'>objects</font></a> to which the rule applies. The conclusion is a CLAIRE expression that uses
 the same free variables. An event is an <a href='Updates.html#4611703541553810866'><font color='#'>update</font></a> on these <a href='Objects and Entities.html#4611703541553611170'><font color='#'>objects</font></a>, either the change of a <a href='Calls and Slot Access.html#4611703541553806482'><font color='#'>slot</font></a> or
 a <a href='Tables.html#4611703541554717490'><font color='#'>table</font></a> value, or the <a href='Instantiation.html#4611703541554143698'><font color='#'>instantiation</font></a> of a <a href='Classes.html#4611703541553622690'><font color='#'>class</font></a>. A rule condition is checked if and only if an
 event has occurred.
 </i></p></td></tr></table>
									<p align='justify' class='doc_paragraph'> A novelty in CLAIRE 3.0 is the introduction of event logic. There are two events that can be
 matched precisely: the <a href='Updates.html#4611703541553810866'><font color='#'>update</font></a> of a <a href='Calls and Slot Access.html#4611703541553806482'><font color='#'>slot</font></a> or a <a href='Tables.html#4611703541554717490'><font color='#'>table</font></a>, and the <a href='Instantiation.html#4611703541554143698'><font color='#'>instantiation</font></a> of a <a href='Classes.html#4611703541553622690'><font color='#'>class</font></a>. CLAIRE
 3.2 use expressions called event pattern to specify which kind of events the rule is associated
 with. For instance, the expression x.r&nbsp;:= y is an event expression that says both that x.r = y
 and that the <a href='Lists_comma Sets and Tuples.html#4611703541555705426'><font color='#'>last</font></a> event is actually the <a href='Updates.html#4611703541553810866'><font color='#'>update</font></a> of x.r from a previous value. More precisely,
 here are the events that are supported&nbsp;:
 </p>
							  <ul> <li>x.r&nbsp;:= y, where r is a <a href='Calls and Slot Access.html#4611703541553806482'><font color='#'>slot</font></a> of x.
 <li>a[x]&nbsp;:= y, where a is a.
 <li>x.r&nbsp;:<a href='Classes.html#4611703541555561714'><font color='#'>add</font></a> y, where r is a multi-valued <a href='Calls and Slot Access.html#4611703541553806482'><font color='#'>slot</font></a> of x (with range <a href='Lists_comma Sets and Tuples.html#4611703541553841378'><font color='#'>bag</font></a>).
 <li>a[x]&nbsp;:<a href='Classes.html#4611703541555561714'><font color='#'>add</font></a> y, where a is a multi-valued <a href='Tables.html#4611703541554717490'><font color='#'>table</font></a>.
 </ul>
							  <p align='justify' class='doc_paragraph'> Note that an <a href='Updates.html#4611703541553810866'><font color='#'>update</font></a> of the <a href='Types.html#4611703541554225330'><font color='#'>type</font></a> x.r&nbsp;:<a href='Classes.html#4611703541555561922'><font color='#'>delete</font></a> y (resp. a[x]&nbsp;:<a href='Classes.html#4611703541555561922'><font color='#'>delete</font></a> y), where r is a <a href='Calls and Slot Access.html#4611703541553806482'><font color='#'>slot</font></a> of x
 (resp. a is a <a href='Tables.html#4611703541554717490'><font color='#'>table</font></a>), will never be considered as an event if r is multi-valued. However, one
 can always <a href='Strings.html#4611703541555490898'><font color='#'>replace</font></a> this declaration by x.r&nbsp;:= <a href='Classes.html#4611703541555561922'><font color='#'>delete</font></a>(x.r, y) which is an event, but which costs
 a memory allocation for the creation of the <a href='Classes.html#4611703541555700274'><font color='#'>new</font></a> x.r.</p><p align='justify' class='doc_paragraph'> In addition, a <a href='Classes.html#4611703541555700274'><font color='#'>new</font></a> event pattern was introduced in CLAIRE 3.0 to capture the transition from
 an old to a <a href='Classes.html#4611703541555700274'><font color='#'>new</font></a> value. This is achieved with the expression x.r&nbsp;:= (z &lt;- y) which says that
 the <a href='Lists_comma Sets and Tuples.html#4611703541555705426'><font color='#'>last</font></a> event is the <a href='Updates.html#4611703541553810866'><font color='#'>update</font></a> of x.r from z to y. For instance, here is the event expression
 that states that x.salary crossed the 100000 limit&nbsp;:
 </p><table class='table_code' align=center border=0 width='85%'>
										<tr><td class='doc_code'> x.salary&nbsp;:= (y &lt;- z) &amp; y &lt; 100000 &amp; z &gt;= 100000
</td></tr></table>
							  <p align='justify' class='doc_paragraph'> In CLAIRE 3.2 we introduce the notion of a "pure" event. If a <a href='Selectors_comma Properties and Operations.html#4611703541554686610'><font color='#'>property</font></a> p has no restrictions,
 then p(x,y) represents a virtual <a href='Calls and Slot Access.html#4611703541555624690'><font color='#'>call</font></a> to p with parameters x and y. This event may be used in
 a rule in a way similar to x.p&nbsp;:= y, with the <a href='Lists_comma Sets and Tuples.html#4611703541555706066'><font color='#'>difference</font></a> that it does <a href='Objects and Entities.html#4611703541555698978'><font color='#'>not</font></a> correspond to an
 <a href='Updates.html#4611703541553810866'><font color='#'>update</font></a>. Virtual events are very generic since one of the parameter may be arbitrarily complex
 (a <a href='Lists_comma Sets and Tuples.html#4611703541553841378'><font color='#'>list</font></a>, a <a href='Lists_comma Sets and Tuples.html#4611703541553841378'><font color='#'>set</font></a>, a <a href='Lists_comma Sets and Tuples.html#4611703541553841378'><font color='#'>tuple</font></a> ...). The event <a href='Communication ports.html#4611703541555973250'><font color='#'>filter</font></a> associated to a virtual event is simply the
 expression "p(x,y)". To create such an event, one simply <a href='Calls and Slot Access.html#4611703541553806482'><font color='#'>calls</font></a> p(x,y), once a rule using such
 an event has been defined. As a matter of fact, the definition of a rule using p(x,y) as an
 event pattern will provoke the creation of a generic <a href='Methods.html#4611703541554221778'><font color='#'>method</font></a> p that creates the event.</p><p align='justify' class='doc_paragraph'> Virtual event may be used for many purposes. The creation of a virtual event requires no
 <a href='Dates and Times.html#4611703541553608578'><font color='#'>time</font></a> nor memory; thus, it is a convenient technique to capture state transition in your
 <a href='Objects and Entities.html#4611703541553611170'><font color='#'>object</font></a> system. For instance, we can create an event signaling the <a href='Instantiation.html#4611703541554143698'><font color='#'>instantiation</font></a> of a <a href='Classes.html#4611703541553622690'><font color='#'>class</font></a>
 as follows&nbsp;:
 </p><table class='table_code' align=center border=0 width='85%'>
										<tr><td class='doc_code'> <a href='Instantiation.html#4611703541554143698'><font color='#'>instantiation</font></a>&nbsp;:: <a href='Selectors_comma Properties and Operations.html#4611703541554686610'><font color='#'>property</font></a>(domain = myClass, range = <a href='Strings.html#4611703541553610770'><font color='#'>string</font></a>)

 [<a href='Classes.html#4611703541555462082'><font color='#'>close</font></a>(x:MyClass)&nbsp;: MyClass -&gt; <a href='Instantiation.html#4611703541554143698'><font color='#'>instantiation</font></a>(x,date!(1)), x]

 controlRule()&nbsp;:: rule(<a href='Instantiation.html#4611703541554143698'><font color='#'>instantiation</font></a>(x,s) =&gt; printf("--- create ~S at ~A <n",x,s))></td></tr></table>
							  <p align='justify' class='doc_paragraph'> To define a rule, we must indeed define&nbsp;:
 </p>
							  <ul> <li>a condition, which is the combination of an event pattern and a CLAIRE Boolean expression using the same variables
 <li>a conclusion that is preceded by =&gt;.
 </ul>
							  <p align='justify' class='doc_paragraph'> Here is a classical transitive closure example&nbsp;:
 </p><table class='table_code' align=center border=0 width='85%'>
										<tr><td class='doc_code'> r1()&nbsp;:: rule(x.friends&nbsp;:<a href='Classes.html#4611703541555561714'><font color='#'>add</font></a> y =&gt; for z in y.friend x.friends&nbsp;:<a href='Classes.html#4611703541555561714'><font color='#'>add</font></a> z)
</td></tr></table>
							  <p align='justify' class='doc_paragraph'> Rules are named (for easier <a href='Debugging.html#4611703541555449938'><font color='#'>debugging</font></a>) and can use any CLAIRE expression as a conclusion,
 using the event parameters as variables. Rule triggering can be traced using trace(if_write).
 Notice that a rule definition in CLAIRE 3.2 has no parameters; rules
 with parameters require the presence of the ClaireRules library, which is no longer available.</p><p align='justify' class='doc_paragraph'> For instance, let us define the following rule to fill the <a href='Tables.html#4611703541554717490'><font color='#'>table</font></a> fib with the Fibonacci sequence&nbsp;:
 </p><table class='table_code' align=center border=0 width='85%'>
										<tr><td class='doc_code'> r3()&nbsp;:: rule(y&nbsp;:= fib[x] &amp; x <a href='Types.html#4611703541555504450'><font color='#'>%</font></a> (0 .. 100)
 		=&gt; when z&nbsp;:= <a href='Classes.html#4611703541555561426'><font color='#'>get</font></a>(fib,x - 1) in fib[x + 1]&nbsp;:= y + z)

 (fib[0]&nbsp;:= 1, fib[1]&nbsp;:= 1)
</td></tr></table>
							  <p align='justify' class='doc_paragraph'></p></body>
	</html>